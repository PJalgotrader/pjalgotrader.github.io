<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Exponential Smoothing (SES) - Interactive Learning Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js@2.27.0/dist/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .equations-panel {
            background: #f8f9fa;
            padding: 25px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .equation-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .equation-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .equation {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            color: #333;
            text-align: center;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .controls-panel {
            padding: 30px;
            background: white;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1.1em;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .value-display {
            min-width: 60px;
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            font-size: 1.1em;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        button {
            padding: 12px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .visualization-panel {
            padding: 30px;
            background: white;
        }
        
        .chart-container {
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .info-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .info-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        .iteration-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .iteration-info h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .math-step {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            overflow-x: auto;
        }
        
        .highlight {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .animating {
            animation: pulse 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Simple Exponential Smoothing (SES)</h1>
            <p>Interactive Learning Tool - Understand How Levels Develop Through Time</p>
        </div>
        
        <div class="equations-panel">
            <div class="equation-box">
                <h3>üéØ Forecast Equation</h3>
                <div class="equation">≈∑<sub>t+h|t</sub> = ‚Ñì<sub>t</sub></div>
                <p style="text-align: center; color: #666; margin-top: 10px;">
                    The forecast for any future period is simply the current level
                </p>
            </div>
            
            <div class="equation-box">
                <h3>üîÑ Smoothing Equation</h3>
                <div class="equation">‚Ñì<sub>t</sub> = Œ±¬∑y<sub>t</sub> + (1-Œ±)¬∑‚Ñì<sub>t-1</sub></div>
                <p style="text-align: center; color: #666; margin-top: 10px;">
                    Level at time t is a weighted average of current observation and previous level
                </p>
            </div>
        </div>
        
        <div class="controls-panel">
            <div class="control-group">
                <label for="alpha">Smoothing Parameter (Œ±)</label>
                <div class="slider-container">
                    <input type="range" id="alpha" min="0.01" max="0.99" step="0.01" value="0.3">
                    <span class="value-display" id="alphaValue">0.30</span>
                </div>
                <small style="color: #666; margin-top: 5px; display: block;">
                    Higher Œ± = More weight on recent data
                </small>
            </div>
            
            <div class="control-group">
                <label for="l0">Initial Level (‚Ñì‚ÇÄ)</label>
                <div class="slider-container">
                    <input type="range" id="l0" min="50" max="200" step="1" value="112">
                    <span class="value-display" id="l0Value">112</span>
                </div>
                <small style="color: #666; margin-top: 5px; display: block;">
                    Starting point for smoothing
                </small>
            </div>
            
            <div class="control-group">
                <label for="speed">Animation Speed</label>
                <div class="slider-container">
                    <input type="range" id="speed" min="100" max="2000" step="100" value="500">
                    <span class="value-display" id="speedValue">500ms</span>
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-primary" onclick="startAnimation()">üé¨ Start Animation</button>
            <button class="btn-secondary" onclick="pauseAnimation()">‚è∏Ô∏è Pause</button>
            <button class="btn-secondary" onclick="resetVisualization()">üîÑ Reset</button>
            <button class="btn-primary" onclick="showFullFit()">‚ö° Show Complete Fit</button>
        </div>
        
        <div class="visualization-panel">
            <div class="iteration-info" id="iterationInfo" style="display: none;">
                <h3>Current Iteration Details</h3>
                <div id="iterationDetails"></div>
            </div>
            
            <div class="chart-container">
                <div id="mainChart"></div>
            </div>
            
            <div class="chart-container">
                <div id="levelChart"></div>
            </div>
            
            <div class="info-cards">
                <div class="info-card">
                    <h4>Current Time Step</h4>
                    <div class="value" id="currentStep">0</div>
                </div>
                <div class="info-card">
                    <h4>Current Level</h4>
                    <div class="value" id="currentLevel">-</div>
                </div>
                <div class="info-card">
                    <h4>Training RMSE</h4>
                    <div class="value" id="trainRMSE">-</div>
                </div>
                <div class="info-card">
                    <h4>Test RMSE</h4>
                    <div class="value" id="testRMSE">-</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Airline passenger data (monthly from 1949 to 1960)
        const airlineData = [
            112, 118, 132, 129, 121, 135, 148, 148, 136, 119, 104, 118,
            115, 126, 141, 135, 125, 149, 170, 170, 158, 133, 114, 140,
            145, 150, 178, 163, 172, 178, 199, 199, 184, 162, 146, 166,
            171, 180, 193, 181, 183, 218, 230, 242, 209, 191, 172, 194,
            196, 196, 236, 235, 229, 243, 264, 272, 237, 211, 180, 201,
            204, 188, 235, 227, 234, 264, 302, 293, 259, 229, 203, 229,
            242, 233, 267, 269, 270, 315, 364, 347, 312, 274, 237, 278,
            284, 277, 317, 313, 318, 374, 413, 405, 355, 306, 271, 306,
            315, 301, 356, 348, 355, 422, 465, 467, 404, 347, 305, 336,
            340, 318, 362, 348, 363, 435, 491, 505, 404, 359, 310, 337,
            360, 342, 406, 396, 420, 472, 548, 559, 463, 407, 362, 405,
            417, 391, 419, 461, 472, 535, 622, 606, 508, 461, 390, 432
        ];
        
        // Create time index
        const timeIndex = Array.from({length: airlineData.length}, (_, i) => i + 1);
        
        // Split data into train and test (80/20 split)
        const splitIndex = Math.floor(airlineData.length * 0.8);
        const trainData = airlineData.slice(0, splitIndex);
        const testData = airlineData.slice(splitIndex);
        const trainTime = timeIndex.slice(0, splitIndex);
        const testTime = timeIndex.slice(splitIndex);
        
        // Global variables for animation
        let animationId = null;
        let currentIteration = 0;
        let levels = [];
        let forecasts = [];
        let alpha = 0.3;
        let l0 = 112;
        
        // Initialize controls
        document.getElementById('alpha').addEventListener('input', function(e) {
            alpha = parseFloat(e.target.value);
            document.getElementById('alphaValue').textContent = alpha.toFixed(2);
            if (currentIteration > 0) {
                resetVisualization();
            }
        });
        
        document.getElementById('l0').addEventListener('input', function(e) {
            l0 = parseFloat(e.target.value);
            document.getElementById('l0Value').textContent = l0;
            if (currentIteration > 0) {
                resetVisualization();
            }
        });
        
        document.getElementById('speed').addEventListener('input', function(e) {
            document.getElementById('speedValue').textContent = e.target.value + 'ms';
        });
        
        function calculateSES(data, alpha, l0) {
            let levels = [l0];
            let forecasts = [];
            
            for (let t = 0; t < data.length; t++) {
                // Forecast for time t is the previous level
                forecasts.push(levels[levels.length - 1]);
                // Calculate new level after observing y_t
                let newLevel = alpha * data[t] + (1 - alpha) * levels[levels.length - 1];
                levels.push(newLevel);
            }
            
            return { levels, forecasts };
        }
        
        function animateStep() {
            if (currentIteration >= trainData.length) {
                // Start forecasting phase
                if (currentIteration < trainData.length + testData.length) {
                    updateTestForecast();
                } else {
                    pauseAnimation();
                    showMetrics();
                }
                return;
            }
            
            const y_t = trainData[currentIteration];
            const l_prev = currentIteration === 0 ? l0 : levels[currentIteration - 1];
            
            // The forecast for time t was made at time t-1 using l_{t-1}
            if (currentIteration === 0) {
                forecasts.push(l0);  // First forecast uses l0
            } else {
                forecasts.push(levels[currentIteration - 1]);  // Forecast uses previous level
            }
            
            // Now calculate the new level after observing y_t
            const l_t = alpha * y_t + (1 - alpha) * l_prev;
            levels.push(l_t);
            
            // Update iteration info
            updateIterationInfo(currentIteration, y_t, l_prev, l_t);
            
            // Update charts
            updateCharts();
            
            // Update info cards
            document.getElementById('currentStep').textContent = currentIteration + 1;
            document.getElementById('currentLevel').textContent = l_t.toFixed(1);
            
            currentIteration++;
            
            const speed = parseInt(document.getElementById('speed').value);
            animationId = setTimeout(animateStep, speed);
        }
        
        function updateIterationInfo(t, y_t, l_prev, l_t) {
            const info = document.getElementById('iterationInfo');
            const details = document.getElementById('iterationDetails');
            
            info.style.display = 'block';
            info.classList.add('animating');
            
            details.innerHTML = `
                <div class="math-step">
                    <strong>Time t = ${t + 1}</strong>, Actual value y<sub>${t + 1}</sub> = ${y_t}
                </div>
                <div class="math-step">
                    <strong>Smoothing equation:</strong> ‚Ñì<sub>${t + 1}</sub> = Œ±¬∑y<sub>${t + 1}</sub> + (1-Œ±)¬∑‚Ñì<sub>${t}</sub>
                </div>
                <div class="math-step">
                    ‚Ñì<sub>${t + 1}</sub> = ${alpha.toFixed(2)} √ó ${y_t} + ${(1 - alpha).toFixed(2)} √ó ${l_prev.toFixed(1)}
                </div>
                <div class="math-step">
                    ‚Ñì<sub>${t + 1}</sub> = ${(alpha * y_t).toFixed(1)} + ${((1 - alpha) * l_prev).toFixed(1)} = <span class="highlight">${l_t.toFixed(1)}</span>
                </div>
                <div class="math-step">
                    <strong>Forecast:</strong> ≈∑<sub>${t + 2}|${t + 1}</sub> = ‚Ñì<sub>${t + 1}</sub> = ${l_t.toFixed(1)}
                </div>
            `;
            
            setTimeout(() => info.classList.remove('animating'), 500);
        }
        
        function updateTestForecast() {
            const testIndex = currentIteration - trainData.length;
            const lastLevel = levels[levels.length - 1];
            
            // For SES, all future forecasts are the last level
            forecasts.push(lastLevel);
            
            updateCharts();
            
            document.getElementById('currentStep').textContent = currentIteration + 1;
            currentIteration++;
            
            const speed = parseInt(document.getElementById('speed').value);
            animationId = setTimeout(animateStep, speed);
        }
        
        function updateCharts() {
            const trainForecastsToShow = forecasts.slice(0, Math.min(currentIteration + 1, trainData.length));
            const testForecastsToShow = forecasts.slice(trainData.length, currentIteration + 1);
            const levelsToShow = levels.slice(0, Math.min(currentIteration + 1, trainData.length + 1));
            
            // Main chart
            const traces = [
                {
                    x: trainTime,
                    y: trainData,
                    mode: 'lines+markers',
                    name: 'Training Data',
                    line: { color: 'blue', width: 2 },
                    marker: { size: 4 }
                },
                {
                    x: testTime,
                    y: testData,
                    mode: 'lines+markers',
                    name: 'Test Data',
                    line: { color: 'lightblue', width: 2, dash: 'dash' },
                    marker: { size: 4 }
                },
                {
                    x: trainTime.slice(0, trainForecastsToShow.length),
                    y: trainForecastsToShow,
                    mode: 'lines+markers',
                    name: 'Fitted Values',
                    line: { color: 'red', width: 2 },
                    marker: { size: 6, symbol: 'circle-open' }
                }
            ];
            
            if (testForecastsToShow.length > 0) {
                traces.push({
                    x: testTime.slice(0, testForecastsToShow.length),
                    y: testForecastsToShow,
                    mode: 'lines+markers',
                    name: 'Forecasts',
                    line: { color: 'orange', width: 2 },
                    marker: { size: 6, symbol: 'square-open' }
                });
            }
            
            const layout1 = {
                title: 'Airline Passengers - SES Fitting and Forecasting',
                xaxis: { title: 'Time (Months)' },
                yaxis: { title: 'Number of Passengers' },
                showlegend: true,
                height: 400,
                hovermode: 'x'
            };
            
            Plotly.newPlot('mainChart', traces, layout1);
            
            // Level evolution chart - show only levels
            const levelTrace = {
                x: trainTime.slice(0, levelsToShow.length),
                y: levelsToShow,
                mode: 'lines+markers',
                name: 'Level Component ‚Ñì_t',
                line: { color: 'purple', width: 3 },
                marker: { size: 8, color: 'purple' },
                fill: 'tonexty',
                fillcolor: 'rgba(147, 112, 219, 0.1)'
            };
            
            const layout2 = {
                title: 'Evolution of Level Component (‚Ñì_t)',
                xaxis: { title: 'Time (Months)' },
                yaxis: { title: 'Level Value' },
                showlegend: true,
                height: 300,
                annotations: levelsToShow.length > 0 ? [{
                    x: trainTime[levelsToShow.length - 1],
                    y: levelsToShow[levelsToShow.length - 1],
                    xref: 'x',
                    yref: 'y',
                    text: `‚Ñì_${levelsToShow.length} = ${levelsToShow[levelsToShow.length - 1].toFixed(1)}`,
                    showarrow: true,
                    arrowhead: 7,
                    ax: -50,
                    ay: -40,
                    bgcolor: 'purple',
                    bordercolor: 'purple',
                    borderwidth: 2,
                    font: { color: 'white' }
                }] : []
            };
            
            Plotly.newPlot('levelChart', [levelTrace], layout2);
            
            // Calculate and display metrics
            if (trainForecastsToShow.length > 1) {
                const trainErrors = trainForecastsToShow.slice(1).map((f, i) => Math.pow(trainData[i + 1] - f, 2));
                const trainRMSE = Math.sqrt(trainErrors.reduce((a, b) => a + b, 0) / trainErrors.length);
                document.getElementById('trainRMSE').textContent = trainRMSE.toFixed(1);
            }
            
            if (testForecastsToShow.length > 0) {
                const testErrors = testForecastsToShow.map((f, i) => Math.pow(testData[i] - f, 2));
                const testRMSE = Math.sqrt(testErrors.reduce((a, b) => a + b, 0) / testErrors.length);
                document.getElementById('testRMSE').textContent = testRMSE.toFixed(1);
            }
        }
        
        function startAnimation() {
            if (animationId) {
                pauseAnimation();
            }
            if (currentIteration === 0 || currentIteration >= trainData.length + testData.length) {
                resetVisualization();
            }
            animateStep();
        }
        
        function pauseAnimation() {
            if (animationId) {
                clearTimeout(animationId);
                animationId = null;
            }
        }
        
        function resetVisualization() {
            pauseAnimation();
            currentIteration = 0;
            levels = [];
            forecasts = [];
            document.getElementById('currentStep').textContent = '0';
            document.getElementById('currentLevel').textContent = '-';
            document.getElementById('trainRMSE').textContent = '-';
            document.getElementById('testRMSE').textContent = '-';
            document.getElementById('iterationInfo').style.display = 'none';
            initializeCharts();
        }
        
        function showFullFit() {
            pauseAnimation();
            resetVisualization();
            
            // Clear existing arrays
            levels = [];
            forecasts = [];
            
            // Calculate full fit for training data
            let currentLevel = l0;
            
            for (let t = 0; t < trainData.length; t++) {
                // Forecast for time t uses the level from t-1
                forecasts.push(currentLevel);
                
                // Calculate new level after observing y_t
                const y_t = trainData[t];
                const newLevel = alpha * y_t + (1 - alpha) * currentLevel;
                levels.push(newLevel);
                currentLevel = newLevel;
            }
            
            // Add test forecasts (all are the last level)
            const lastLevel = levels[levels.length - 1];
            for (let i = 0; i < testData.length; i++) {
                forecasts.push(lastLevel);
            }
            
            currentIteration = trainData.length + testData.length;
            updateCharts();
            showMetrics();
        }
        
        function showMetrics() {
            const trainForecasts = forecasts.slice(0, trainData.length);
            const testForecasts = forecasts.slice(trainData.length);
            
            if (trainForecasts.length > 0) {
                const trainErrors = trainForecasts.map((f, i) => Math.pow(trainData[i] - f, 2));
                const trainRMSE = Math.sqrt(trainErrors.reduce((a, b) => a + b, 0) / trainErrors.length);
                document.getElementById('trainRMSE').textContent = trainRMSE.toFixed(1);
            }
            
            if (testForecasts.length > 0) {
                const testErrors = testForecasts.map((f, i) => Math.pow(testData[i] - f, 2));
                const testRMSE = Math.sqrt(testErrors.reduce((a, b) => a + b, 0) / testErrors.length);
                document.getElementById('testRMSE').textContent = testRMSE.toFixed(1);
            }
            
            document.getElementById('currentStep').textContent = currentIteration;
            document.getElementById('currentLevel').textContent = levels[levels.length - 1].toFixed(1);
        }
        
        function initializeCharts() {
            // Initial empty charts
            const traces1 = [
                {
                    x: trainTime,
                    y: trainData,
                    mode: 'lines+markers',
                    name: 'Training Data',
                    line: { color: 'blue', width: 2 },
                    marker: { size: 4 }
                },
                {
                    x: testTime,
                    y: testData,
                    mode: 'lines+markers',
                    name: 'Test Data',
                    line: { color: 'lightblue', width: 2, dash: 'dash' },
                    marker: { size: 4 }
                }
            ];
            
            const layout1 = {
                title: 'Airline Passengers - SES Fitting and Forecasting',
                xaxis: { title: 'Time (Months)' },
                yaxis: { title: 'Number of Passengers' },
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('mainChart', traces1, layout1);
            
            const layout2 = {
                title: 'Evolution of Level Component (‚Ñì_t)',
                xaxis: { title: 'Time (Months)' },
                yaxis: { title: 'Level Value' },
                showlegend: true,
                height: 300
            };
            
            Plotly.newPlot('levelChart', [], layout2);
        }
        
        // Initialize on load
        initializeCharts();
    </script>
</body>
</html>